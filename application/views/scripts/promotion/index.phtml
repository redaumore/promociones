<?php
    $messages = $this->errorMessage;
      /*echo $this->headLink()->appendStylesheet($this->baseUrl().'/skins/default/css/jquery-ui-1.8.23.custom.css')
            ->appendStylesheet($this->baseUrl().'/skins/default/css/ui.jqgrid.css');
      echo $this->headScript()->appendScript($this->baseUrl().'/scripts/jquery-1.8.0.min.js')
            ->appendScript($this->baseUrl().'/scripts/jquery-ui-1.8.23.custom.min.js')
            ->appendScript($this->baseUrl().'scripts/grid.locale-es.js')
            ->appendScript($this->baseUrl().'/scripts/jquery.jqGrid.min.js');
      */
?>
<script type="text/javascript" src='/scripts/grid.locale-es.js'></script>
<script type="text/javascript" src='/scripts/jquery.jqGrid.min.js'></script>
<script type="text/javascript" src="/scripts/promosalpaso.js"></script>
<div class="row-fluid">
    <div class="row">
        <div class="pagination-centered" id="titulo">
            <h1>Mis Promociones</h1>
        </div>
    </div>
    <hr class="hr-subtitle"/>
    <?php echo $this->errorMessage($this->form, $messages); ?>
    <?php echo $this->partial("index/_alert.phtml"); ?>
    <div id="div_grid_container" class="row-fluid pagination-centered">
            <table width="100%">
                <tr><td align="center">
                    <table id="list2"></table>
                    <div id="pager2"></div>
                </td></tr>
            </table>
        </br>
        </br>
    </div>
    <div class="row-fluid pagination-centered">
        <?php echo $this->partial("promotion/_botonera.phtml"); ?> 
    </div>
</div>
<script type="text/javascript">
    jQuery("#list2").jqGrid({url:_baseUri + 'promotion/datos',datatype: "json",
         colNames:['Acción', 'Código','Inicio', 'Fin', 'Descripción', 'Valor', 'Estado', 'Visitas'],
         colModel:[ {name:'act',index:'act', width:80,sortable:false},
                    {name:'Código',index:'promo_code', width:95}, 
                    {name:'Inicio',index:'starts', width:95},
                    {name:'Fin',index:'ends', width:95},
                    {name:'Descripción',index:'short_description', width:450},
                    {name:'Valor',index:'promo_value', width:70},
                    {name:'Estado',index:'state', width:70},
                    {name:'Visitas',index:'visited', width:70},
         ],
         rowNum:10,
         rowList:[10,20,30],
         pager: '#pager2',
         sortname: 'starts',
         viewrecords: true,
         sortorder: "desc",
         mtype:"POST",
         autowidth: true,
         height: "300px",
         caption:"Promociones",
         gridComplete: function(){
            var ids = jQuery("#list2").jqGrid('getDataIDs');
            if(ids.length == 0 ){
                     showMessage("info", "Aún no tienes promociones cargadas.");
                     jQuery("#gbox_list2").hide();
                     return;
                 }
            for(var i=0;i < ids.length;i++){
                var cl = ids[i];
                var today = new Date();
                var _data_row = jQuery("#list2").getRowData(cl).Inicio.split("/");
                var start = new Date(_data_row[2], parseInt(_data_row[1])-1, _data_row[0]);
                start.setDate(start.getDate()+ 1);
                be = "<div style='float:left;'><a href='/promotion/edit/id/"+cl+"'><span class='ui-icon ui-icon-pencil'></span></a></div>";
                if(start <= today)
                    se = "";
                else 
                    se = "<div style='float:left;'><a href='/promotion/delete/id/"+cl+"'><span class='ui-icon ui-icon-trash'></span></a></div>"; 
                jQuery("#list2").jqGrid('setRowData',ids[i],{act:be+se});
            }    
    },
     })
     //jQuery("#list2").jqGrid('GridNav','#pager2',{edit:false,add:false,del:false});
     
     $(window).bind('resize', function() {
        //$('#list2').setGridWidth(width, true); //Back to original width
        $('#list2').setGridWidth($('#div_grid_container').width(), true); //Resized to new width as per window
     }).trigger('resize');
</script>
 